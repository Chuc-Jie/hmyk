import{_ as $,d as O,r as G,a as J,o as K,w as P,c as E,b as n,g as o,A as Q,u as W,i,j as s,f as _,e as r,h as m,t as h,n as p,k as j,F as T,m as q,p as X,H as Y}from"./index.9ff7eb4f.js";import{a as Z,b as aa}from"./goods.a89672a5.js";import{F as ea,_ as oa}from"./footer.1784d682.js";import{L as A}from"./storage.d2b28a6e.js";const ta={class:"container"},sa=["src"],da={class:"goods-name-box"},na={class:"goods-name mr-2"},la={class:"goods-params"},ia={style:{"margin-top":"20px","word-break":"break-word","line-height":"33px"},class:"sku-block example-block"},ra={style:{"margin-right":"10px"}},ga=["data-sku-name","data-sku","id","onClick"],ca=p("\u63D0\u4EA4\u8BA2\u5355"),ua=p("\u8BF7\u9009\u62E9\u89C4\u683C"),_a=p("\u5E93\u5B58\u4E0D\u8DB3"),ma=p("\u5F53\u524D\u5546\u54C1\u6682\u672A\u6DFB\u52A0\u4ECB\u7ECD~"),pa=["innerHTML"],va={class:"dialog-footer"},fa=p("\u786E\u5B9A"),xa=O({__name:"goods",setup(ka){const B=Q(),H=W(),a=G({goods_num:1,ejectDialog:!1,goods:{category:{name:""}},form:{},data:{template:{site:{}}},goods_dialog:!1,sku_all:!0,real_price:0}),D=J();K(()=>{P(()=>{a.data.template=D.value.state.data,a.goods_id!=B.query.goods_id&&B.query.goods_id!=null&&(a.goods_id=B.query.goods_id,Z(a.goods_id).then(v=>{if(console.log(D.value.state.data),a.data.template=D.value.state.data,a.goods=v.data.goods,a.real_price=a.goods.real_price,a.goods.sku!=""&&a.goods.sku!=null&&(a.sku_all=!1),a.goods.eject!=""&&a.goods.eject!=null){var t=A.get("goods_dialog_"+a.goods_id);a.data.template.date!=t&&(a.ejectDialog=!0)}else if(a.data.template.options.goods_eject!=""&&a.data.template.options.goods_eject!=null){a.goods.eject=a.data.template.options.goods_eject;var t=A.get("goods_dialog_"+a.goods_id);a.data.template.date!=t&&(a.ejectDialog=!0)}X(a.goods.name+" - "+a.data.template.site.shop_title)}))})});var M=(v,t)=>{var z,N;for(var b=document.getElementsByClassName(t),y=(z=document.getElementById(v))==null?void 0:z.classList.contains("active"),e=0;e<b.length;e++)b[e].classList.remove("active");y||(N=document.getElementById(v))==null||N.classList.add("active");for(var f=document.getElementsByClassName("sku-block"),w=!0,g=[],c={name:[],ids:[],price:0},e=0;e<f.length;e++){for(var x=f[e].getElementsByClassName("tag"),F=!1,u=0;u<x.length;u++)x[u].classList.contains("active")&&(F=!0,g.push(x[u].getAttribute("data-sku")),c.name.push(x[u].getAttribute("data-sku-name")),c.ids.push(x[u].getAttribute("data-sku")));if(F)w=!0;else{w=!1;break}}a.sku_all=w;var d=!1;if(a.sku_all==!0){g=g.toString();for(var C=a.data.template.user,l=[],k=0,e=0;e<a.goods.price.length;e++)g==a.goods.price[e].sku_ids&&l.push(a.goods.price[e]);for(var e=0;e<l.length;e++)C.agent>=l[e].grade_id&&(k=l[e].price,a.real_price=k);a.goods_num=1;var L=k*a.goods_num;a.goods.real_price=L.toFixed(2),c.price=k,console.log(c),d=c.ids,A.set("goods-sku-"+a.goods.id,c)}var U={goods_id:a.goods_id,goods_type:a.goods.goods_type,sku_ids:d.toString()};aa(U).then(V=>{console.log(V),a.goods.stock_show=V.data.stock_text,a.goods.stock=V.data.stock_number})},R=()=>{var v=a.real_price*a.goods_num;a.goods.real_price=v.toFixed(2)},S=()=>{a.goods.stock<a.goods_num||H.push({path:"/cfm",query:{goods_id:a.goods.id,goods_num:a.goods_num}})},I=()=>{a.ejectDialog=!1,a.goods_dialog==!0&&A.set("goods_dialog_"+B.query.goods_id,a.data.template.date)};return(v,t)=>{const b=i("el-col"),y=i("el-tag"),e=i("el-input-number"),f=i("el-button"),w=i("el-row"),g=i("el-card"),c=i("el-main"),x=i("el-checkbox"),F=i("el-dialog"),u=i("el-container");return s(),E("div",ta,[n(oa,{ref_key:"headerRef",ref:D},null,512),n(u,null,{default:o(()=>[n(c,{class:"main"},{default:o(()=>[n(g,{class:"box-card","body-style":"padding: 20px;"},{default:o(()=>[n(w,{gutter:30,class:"card-row"},{default:o(()=>[a.data.template.hidden_cover==0?(s(),_(b,{key:0,xs:24,sm:9,md:8,lg:8,xl:8},{default:o(()=>[r("img",{class:"goods-image",src:a.goods.cover},null,8,sa)]),_:1})):m("",!0),n(b,{xs:24,sm:15,md:16,lg:16,xl:16},{default:o(()=>[r("div",da,[r("span",na,h(a.goods.name),1),a.data.template.stock==1?(s(),_(y,{key:0,class:"",type:"warning"},{default:o(()=>[p("\u5E93\u5B58"+h(a.goods.stock_show),1)]),_:1})):m("",!0),a.data.template.sales==1?(s(),_(y,{key:1,class:"ml-2",type:"info"},{default:o(()=>[p("\u9500\u91CF"+h(a.goods.sales),1)]),_:1})):m("",!0)]),r("div",la,[n(y,{class:"goods-price",type:"danger"},{default:o(()=>[p("\uFFE5"+h(a.goods.real_price),1)]),_:1}),n(e,{class:"goods-number",modelValue:a.goods_num,"onUpdate:modelValue":t[0]||(t[0]=d=>a.goods_num=d),min:1,max:9999,onChange:t[1]||(t[1]=d=>j(R)())},null,8,["modelValue"]),r("div",null,[(s(!0),E(T,null,q(a.goods.sku,(d,C)=>(s(),E("div",ia,[r("span",ra,h(d.name),1),(s(!0),E(T,null,q(d.value,(l,k)=>(s(),E("span",{"data-sku-name":C+"\uFF1A"+l.name,class:Y("tag tag-"+C),"data-sku":l.id,id:"tag-"+l.id+k,onClick:L=>j(M)("tag-"+l.id+k,"tag-"+C)},h(l.name),11,ga))),256))]))),256))]),r("div",null,[a.goods.stock>0&&a.sku_all==!0&&a.goods.stock>=a.goods_num?(s(),_(f,{key:0,onClick:j(S),type:"primary",class:"sub-btn",size:"large "},{default:o(()=>[ca]),_:1},8,["onClick"])):m("",!0),a.goods.stock>0&&a.sku_all==!1?(s(),_(f,{key:1,type:"primary",class:"sub-btn",size:"large",disabled:""},{default:o(()=>[ua]),_:1})):m("",!0),a.goods.stock<1||a.goods.stock<a.goods_num?(s(),_(f,{key:2,type:"primary",class:"sub-btn",size:"large",disabled:""},{default:o(()=>[_a]),_:1})):m("",!0)])])]),_:1})]),_:1})]),_:1}),a.goods.details!=""?(s(),_(g,{key:0,shadow:"always",class:"box-card goods-details",innerHTML:a.goods.details,style:{padding:"15px 20px","margin-top":"20px"}},null,8,["innerHTML"])):m("",!0),a.goods.details==""?(s(),_(g,{key:1,shadow:"always",class:"box-card",style:{"margin-top":"20px"}},{default:o(()=>[ma]),_:1})):m("",!0)]),_:1}),n(F,{modelValue:a.ejectDialog,"onUpdate:modelValue":t[3]||(t[3]=d=>a.ejectDialog=d),"custom-class":"eject-dialog",draggable:"","show-close":!1},{footer:o(()=>[r("span",va,[n(x,{modelValue:a.goods_dialog,"onUpdate:modelValue":t[2]||(t[2]=d=>a.goods_dialog=d),label:"\u4ECA\u65E5\u4E0D\u518D\u5F39\u51FA",size:"large",style:{position:"absolute",left:"15px",bottom:"10px"}},null,8,["modelValue"]),n(f,{type:"primary",onClick:j(I)},{default:o(()=>[fa]),_:1},8,["onClick"])])]),default:o(()=>[r("div",{innerHTML:a.goods.eject},null,8,pa)]),_:1},8,["modelValue"])]),_:1}),n(ea,{pet_name:a.data.template.site.shop_pet_name,beian:a.data.template.site.beian},null,8,["pet_name","beian"])])}}});var Ca=$(xa,[["__scopeId","data-v-1084a691"]]);export{Ca as default};
