import{_ as O,d as P,r as S,a as $,o as H,w as J,c as p,b as t,f as o,A as T,u as M,h as u,i as s,e as r,m,g as i,t as c,n as _,F as x,l as v,j as G,p as K}from"./index.08eb56a6.js";import{g as Q}from"./goods.23bc6ffd.js";import{c as C,F as W,H as X}from"./footer.dd270afd.js";import{L as Y}from"./storage.d2b28a6e.js";const Z="/api/v1/pisces/";function ee(k){return C({url:Z+"cfm/goods_id/"+k,method:"get"})}const ae="/api/v1/pisces/";function oe(){return C({url:ae+"payList",method:"get"})}const te={class:"container"},le=["src"],ne={class:"goods-name-box"},se={class:"goods-name"},de={class:"goods-params"},ue={style:{"margin-right":"5px"}},re={class:"goods-params"},ie={key:0,class:"goods-params",style:{"margin-top":"0"}},pe=_("\u4F59\u989D\u652F\u4ED8"),me={key:1,class:"goods-params",style:{"margin-top":"0","padding-bottom":"10px"}},ce=_("\u63D0\u4EA4\u8BA2\u5355"),_e=_("\u5E93\u5B58\u4E0D\u8DB3"),ge=_("\u8BE5\u5546\u54C1\u767B\u9646\u540E\u624D\u80FD\u8D2D\u4E70"),ye=P({__name:"cfm",setup(k){const F=T(),w=M(),e=S({goods_num:1,goods:{},order:{},form:{inputs:[]},pay_type:"",loading:!1,inputs:[],pay_list:[],template:{site:{},user:{},options:{buy_data:[{required:null},{required:null}]}},sku_local:{},buy_money:0}),E=$();e.goods_id=F.query.goods_id,e.goods_num=F.query.goods_num,H(()=>{J(()=>{e.template=E.value.state.data,K("\u786E\u8BA4\u8BA2\u5355 - "+e.template.site.shop_title)})});const U=(d,a)=>{var l=document.createElement("form");l.action=d,l.method="post",l.style.display="none";for(var g in a){var y=document.createElement("textarea");y.name=g,y.value=a[g],l.appendChild(y)}return document.body.appendChild(l),l.submit(),l};function z(){var d={coupon:e.coupon,pay_type:e.pay_type,buy_num:e.goods_num,goods_id:e.goods_id,inputs:JSON.stringify(e.inputs),email:e.email,password:e.password,sku_ids:e.sku_local.ids};Q(d).then(a=>{if(a.mode=="form")U(a.gateway_url,a.data);else if(a.mode=="jump")location.href=a.gateway_url;else if(a.mode=="jump-router")w.push(a.router);else{var l=encodeURIComponent(window.btoa(encodeURIComponent(JSON.stringify(a))));w.push({path:"/pay",query:{post:l}})}})}oe().then(d=>{e.pay_list=d.data}),ee(e.goods_id).then(d=>{e.goods=d.data.goods,e.order=d.data.order,e.email=e.order.email,e.password=e.order.password;for(let l in d.data.goods.inputs)e.inputs.push({name:d.data.goods.inputs[l].name,title:d.data.goods.inputs[l].title,placeholder:d.data.goods.inputs[l].placeholder,value:""});var a=Y.get("goods-sku-"+e.goods.id);console.log(a),a!=null&&(e.sku_local=a,e.goods.real_price=e.sku_local.price,e.buy_money=(e.goods.real_price*e.goods_num).toFixed(2))});var N=()=>{e.buy_money=(e.goods.real_price*e.goods_num).toFixed(2)};return(d,a)=>{const l=u("el-col"),g=u("el-tag"),y=u("el-input-number"),b=u("el-form-item"),f=u("el-input"),R=u("el-form"),V=u("el-row"),D=u("el-card"),A=u("el-radio"),q=u("el-radio-group"),h=u("el-button"),L=u("el-main"),j=u("el-container");return s(),p("div",te,[t(X,{ref_key:"headerRef",ref:E},null,512),t(j,null,{default:o(()=>[t(L,{class:"main"},{default:o(()=>[t(D,{class:"box-card","body-style":"padding: 20px;"},{default:o(()=>[t(V,{gutter:15,class:"card-row"},{default:o(()=>[e.template.hidden_cover==0?(s(),r(l,{key:0,xs:6,sm:3,md:2,lg:2,xl:2},{default:o(()=>[m("img",{class:"goods-image",src:e.goods.cover,fit:"contain"},null,8,le)]),_:1})):i("",!0),t(l,{xs:18,sm:21,md:22,lg:22,xl:22},{default:o(()=>[m("div",ne,[m("span",se,c(e.goods.name),1)]),m("div",de,[t(g,{class:"goods-price",type:"danger"},{default:o(()=>[_("\u5546\u54C1\u5355\u4EF7\uFF1A\uFFE5"+c(e.goods.real_price),1)]),_:1})])]),_:1}),t(l,{xl:24,style:{"margin-top":"20px"}},{default:o(()=>[Object.keys(e.sku_local).length>0?(s(),r(g,{key:0,class:"",type:"primary",style:{"margin-right":"10px"}},{default:o(()=>[(s(!0),p(x,null,v(e.sku_local.name,n=>(s(),p("span",ue,c(n)+"\uFF1B",1))),256)),m("span",null,"\u8D2D\u4E70\u6570\u91CF\uFF1A"+c(e.goods_num)+"\uFF1B\u8D2D\u4E70\u603B\u4EF7\uFF1A"+c(e.buy_money),1)]),_:1})):i("",!0)]),_:1}),t(l,{xl:24},{default:o(()=>[m("div",re,[t(R,{"label-position":"top","label-width":"100px",model:e.form,style:{"max-width":"350px","margin-top":"20px"}},{default:o(()=>[t(b,{label:"\u8D2D\u4E70\u6570\u91CF"},{default:o(()=>[t(y,{class:"goods-number",modelValue:e.goods_num,"onUpdate:modelValue":a[0]||(a[0]=n=>e.goods_num=n),min:1,max:9999,onChange:a[1]||(a[1]=n=>G(N)())},null,8,["modelValue"])]),_:1}),e.template.options.coupon==1&&e.goods.real_price>0?(s(),r(b,{key:0,label:"\u4F18\u60E0\u5238"},{default:o(()=>[t(f,{size:"large",modelValue:e.coupon,"onUpdate:modelValue":a[2]||(a[2]=n=>e.coupon=n),placeholder:"\u6CA1\u6709\u4F18\u60E0\u5238\u53EF\u7559\u7A7A"},null,8,["modelValue"])]),_:1})):i("",!0),(s(!0),p(x,null,v(e.inputs,(n,B)=>(s(),r(b,{label:n.title},{default:o(()=>[t(f,{size:"large",modelValue:e.inputs[B].value,"onUpdate:modelValue":I=>e.inputs[B].value=I,placeholder:n.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]))),256)),e.template.options.buy_data[0].buy=="checked"?(s(),r(b,{key:1,label:e.template.options.buy_data[0].name},{default:o(()=>[t(f,{size:"large",modelValue:e.email,"onUpdate:modelValue":a[3]||(a[3]=n=>e.email=n),placeholder:e.template.options.buy_data[0].placeholder},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):i("",!0),e.template.options.buy_data[1].buy=="checked"?(s(),r(b,{key:2,label:e.template.options.buy_data[1].name},{default:o(()=>[t(f,{size:"large",modelValue:e.password,"onUpdate:modelValue":a[4]||(a[4]=n=>e.password=n),placeholder:e.template.options.buy_data[1].placeholder},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):i("",!0)]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1}),e.goods.real_price>0?(s(),r(D,{key:0,class:"box-card box-card-pay","body-style":"padding: 15px; padding-bottom: 5px;"},{default:o(()=>[t(V,{gutter:15,class:"card-row"},{default:o(()=>[t(l,{xl:24},{default:o(()=>[e.pay_list.length>0||e.template.user.login==!0?(s(),p("div",ie,[t(q,{modelValue:e.pay_type,"onUpdate:modelValue":a[5]||(a[5]=n=>e.pay_type=n)},{default:o(()=>[(s(!0),p(x,null,v(e.pay_list,n=>(s(),r(A,{label:n.key,border:""},{default:o(()=>[_(c(n.name),1)]),_:2},1032,["label"]))),256)),e.template.user.login==!0?(s(),r(A,{key:0,label:"balance",border:""},{default:o(()=>[pe]),_:1})):i("",!0)]),_:1},8,["modelValue"])])):i("",!0),e.pay_list.length==0&&e.template.user.login==!1?(s(),p("div",me," \u7AD9\u70B9\u672A\u914D\u7F6E\u6536\u6B3E\u63A5\u53E3 ")):i("",!0)]),_:1})]),_:1})]),_:1})):i("",!0),e.goods.stock>0&&(e.pay_list.length>0||e.template.user.login==!0)&&(e.goods.real_price>0||e.template.user.login==!0)?(s(),r(h,{key:1,onClick:a[6]||(a[6]=n=>z()),type:"primary",class:"sub-btn",size:"large ",loading:e.loading},{default:o(()=>[ce]),_:1},8,["loading"])):i("",!0),e.goods.stock<1?(s(),r(h,{key:2,type:"primary",class:"sub-btn",size:"large",disabled:""},{default:o(()=>[_e]),_:1})):i("",!0),e.goods.stock>0&&e.goods.real_price==0&&e.template.user.login==!1?(s(),r(h,{key:3,type:"primary",class:"sub-btn",disabled:"",size:"large"},{default:o(()=>[ge]),_:1})):i("",!0)]),_:1})]),_:1}),t(W,{pet_name:e.template.site.shop_pet_name,beian:e.template.site.beian},null,8,["pet_name","beian"])])}}});var ve=O(ye,[["__scopeId","data-v-60ab70a7"]]);export{ve as default};
